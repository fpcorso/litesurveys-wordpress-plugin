const liteSurveys={surveys:[],templates:{modal:`\n\t\t\t<div class="litesurveys-slidein" data-survey-id="" \n\t\t\t\trole="dialog" \n\t\t\t\taria-labelledby="survey-title-{{id}}"\n\t\t\t\taria-describedby="survey-question-{{id}}"\n\t\t\t\ttabindex="-1">\n\t\t\t\t<button class="litesurveys-slidein-close" \n\t\t\t\t\t\taria-label="<?php esc_attr_e('Close survey', 'litesurveys'); ?>">\n\t\t\t\t</button>\n\t\t\t\t<div class="litesurveys-slidein-content">\n\t\t\t\t\t<h2 id="survey-title-{{id}}" class="screen-reader-text">\n\t\t\t\t\t\t<?php esc_html_e('Quick Survey', 'litesurveys'); ?>\n\t\t\t\t\t</h2>\n\t\t\t\t\t<div class="litesurveys-slidein-content-form">\n\t\t\t\t\t\t<div class="litesurveys-slide-content-field">\n\t\t\t\t\t\t\t<label class="litesurveys-slide-content-label" \n\t\t\t\t\t\t\t\tid="survey-question-{{id}}">\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<div class="litesurveys-slide-content-control" \n\t\t\t\t\t\t\t\trole="group" \n\t\t\t\t\t\t\t\taria-labelledby="survey-question-{{id}}">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,answerButton:`\n\t\t\t<button class="litesurveys-answer-button" \n\t\t\t\ttype="button" \n\t\t\t\trole="radio" \n\t\t\t\taria-checked="false">\n\t\t\t</button>\n\t\t`,openAnswer:`\n\t\t\t<textarea class="litesurveys-slidein-content-textarea" \n\t\t\t\taria-label="<?php esc_attr_e('Your answer', 'litesurveys'); ?>"\n\t\t\t\trows="4"></textarea>\n\t\t`,submitButton:`<button class="litesurveys-slidein-content-button">Submit</button>`},init(){this.loadSurveys()},loadSurveys(){fetch(liteSurveysSettings.ajaxUrl+"surveys").then((response=>response.json())).then((surveys=>{if(!this.hasValidSurveys(surveys)){return}this.surveys=surveys;this.prepareSurveys()}))},prepareSurveys(){this.surveys.forEach((survey=>{this.addModalMarkup(survey);this.addSlideinListeners(survey);this.setPosition(survey);const trigger=survey.targeting_settings.trigger[0];if(trigger.type==="auto"){setTimeout((()=>this.openModal(survey.id)),trigger.auto_timing*1e3)}else if(trigger.type==="exit"){if(!this.exitIntentListenerAdded){document.addEventListener("mouseout",(event=>{if(event.clientY<=10){this.surveys.forEach((s=>{if(s.targeting_settings.trigger[0].type==="exit"){this.openModal(s.id)}}))}}));this.exitIntentListenerAdded=true}}}))},addModalMarkup(survey){const modalElement=document.createElement("div");modalElement.innerHTML=this.templates.modal.trim();const modal=modalElement.firstChild;modal.dataset.surveyId=survey.id;const question=survey.questions[0];modal.querySelector(".litesurveys-slide-content-label").textContent=question.content;const controlDiv=modal.querySelector(".litesurveys-slide-content-control");if(question.type==="multiple-choice"){question.answers.forEach((answer=>{const button=document.createElement("div");button.innerHTML=this.templates.answerButton.trim();button.firstChild.textContent=answer;controlDiv.appendChild(button.firstChild)}))}else{const textarea=document.createElement("div");textarea.innerHTML=this.templates.openAnswer.trim();controlDiv.appendChild(textarea.firstChild);const submitBtn=document.createElement("div");submitBtn.innerHTML=this.templates.submitButton.trim();controlDiv.appendChild(submitBtn.firstChild)}document.body.appendChild(modal)},setPosition(survey){const modal=document.querySelector(`.litesurveys-slidein[data-survey-id="${survey.id}"]`);const horizontalPosition=survey.appearance_settings?.horizontal_position||"right";if(horizontalPosition==="left"){modal.style.setProperty("--litesurveys-slidein-left-spacing","1em");modal.style.setProperty("--litesurveys-slidein-right-spacing","initial")}else{modal.style.setProperty("--litesurveys-slidein-left-spacing","initial");modal.style.setProperty("--litesurveys-slidein-right-spacing","1em")}},addSlideinListeners(survey){const modal=document.querySelector(`.litesurveys-slidein[data-survey-id="${survey.id}"]`);modal.querySelector(".litesurveys-slidein-close").addEventListener("click",(()=>{this.closeModal(survey.id)}));modal.querySelectorAll(".litesurveys-answer-button").forEach((button=>{button.addEventListener("click",(e=>{this.submitSurvey(survey.id,e.target.textContent)}))}));const submitButton=modal.querySelector(".litesurveys-slidein-content-button");if(submitButton){submitButton.addEventListener("click",(()=>{const answer=modal.querySelector(".litesurveys-slidein-content-textarea").value;if(answer.trim()){this.submitSurvey(survey.id,answer.trim())}}))}},openModal(surveyId){const cookieName=`litesurveys-slideinclosed-${surveyId}`;if(!this.getCookie(cookieName)){const modal=document.querySelector(`.litesurveys-slidein[data-survey-id="${surveyId}"]`);modal.classList.add("litesurveys-is-active");modal.focus()}},closeModal(surveyId){const modal=document.querySelector(`.litesurveys-slidein[data-survey-id="${surveyId}"]`);modal.classList.remove("litesurveys-is-active");this.setCookie(`litesurveys-slideinclosed-${surveyId}`,"yes",365)},submitSurvey(surveyId,answer){const survey=this.surveys.find((s=>s.id===surveyId));if(!survey)return;const submission={responses:[{question_id:survey.questions[0].id,content:answer}],page:window.location.href};fetch(liteSurveysSettings.ajaxUrl+`surveys/${surveyId}/submissions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(submission)}).then((()=>{const modal=document.querySelector(`.litesurveys-slidein[data-survey-id="${surveyId}"]`);const content=modal.querySelector(".litesurveys-slidein-content");const form=content.querySelector(".litesurveys-slidein-content-form");form.innerHTML=survey.submit_message;this.setCookie(`litesurveys-slideinclosed-${surveyId}`,"yes",365);setTimeout((()=>this.closeModal(surveyId)),3e3)}))},hasValidSurveys(surveys){return Array.isArray(surveys)&&surveys.length>0&&surveys[0]?.id},setCookie(name,value,days){const date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);document.cookie=`${name}=${value};expires=${date.toUTCString()};path=/;samesite=lax`},getCookie(name){const match=document.cookie.match(new RegExp("(^| )"+name+"=([^;]+)"));return match?match[2]:null}};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",(()=>liteSurveys.init()))}else{liteSurveys.init()}