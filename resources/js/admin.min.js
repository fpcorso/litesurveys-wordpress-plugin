document.addEventListener("DOMContentLoaded",(function(){const form=document.getElementById("survey-edit-form");const questionType=document.getElementById("question-type");const answerOptionsSection=document.querySelector(".answer-options");const answerChoices=document.getElementById("answer-choices");const addAnswerBtn=document.querySelector(".add-answer");const saveTypeInput=document.getElementById("save_type");const submitButtons=document.querySelectorAll('.submitbox button[type="submit"]');if(!form||!questionType||!answerOptionsSection||!answerChoices||!addAnswerBtn||!saveTypeInput){return}function createErrorMessage(message){const div=document.createElement("div");div.className="error-message";div.textContent=message;return div}function addErrorState(element,message){removeErrorState(element);let targetElement;if(element.id==="question-content"){targetElement=element.closest(".question-content-wrapper")}else if(element.classList.contains("answer-options")){targetElement=element.querySelector(".answer-choices-wrapper")}else{targetElement=element;element.classList.add("error");const errorMessage=createErrorMessage(message);element.parentNode.insertBefore(errorMessage,element.nextSibling);return}targetElement.classList.add("error");const errorMessage=createErrorMessage(message);targetElement.appendChild(errorMessage)}function removeErrorState(element){let targetElement;if(element.id==="question-content"){targetElement=element.closest(".question-content-wrapper")}else if(element.classList.contains("answer-options")){targetElement=element.querySelector(".answer-choices-wrapper")}else{targetElement=element;element.classList.remove("error");const nextSibling=element.nextSibling;if(nextSibling&&nextSibling.classList&&nextSibling.classList.contains("error-message")){nextSibling.remove()}return}targetElement.classList.remove("error");const existingError=targetElement.querySelector(".error-message");if(existingError){existingError.remove()}}function toggleAnswerOptions(){answerOptionsSection.style.display=questionType.value==="multiple-choice"?"table-row":"none";clearAllErrors()}function clearAllErrors(){document.querySelectorAll(".error-message").forEach((msg=>msg.remove()));document.querySelectorAll(".error").forEach((element=>{element.classList.remove("error")}))}function createAnswerInput(value=""){const div=document.createElement("div");div.className="answer-choice";div.innerHTML=`\n\t\t\t<input type="text" name="answers[]" value="${value}" class="regular-text">\n\t\t\t<button type="button" class="button remove-answer">Remove</button>\n\t\t`;return div}function addAnswerChoice(){const newAnswer=createAnswerInput();answerChoices.appendChild(newAnswer);removeErrorState(answerOptionsSection)}function removeAnswerChoice(event){if(event.target.classList.contains("remove-answer")){const answerCount=answerChoices.querySelectorAll(".answer-choice").length;if(answerCount>2){event.target.closest(".answer-choice").remove();validateAnswers()}else{addErrorState(answerOptionsSection,"Multiple choice questions must have at least 2 answers.")}}}function validateAnswers(){if(questionType.value==="multiple-choice"){const answers=Array.from(answerChoices.querySelectorAll('input[type="text"]')).map((input=>input.value.trim())).filter((value=>value!==""));if(answers.length<2){addErrorState(answerOptionsSection,"Multiple choice questions must have at least 2 answers.");return false}else{removeErrorState(answerOptionsSection);return true}}return true}function validateForm(event){event.preventDefault();const clickedButton=event.submitter;if(clickedButton){if(clickedButton.classList.contains("button-warning")){saveTypeInput.value="unpublish"}else if(clickedButton.classList.contains("button-primary")){saveTypeInput.value="publish"}else{saveTypeInput.value="draft"}}clearAllErrors();const surveyName=document.getElementById("survey-name");const questionContent=document.getElementById("question-content");let isValid=true;if(!surveyName.value.trim()){addErrorState(surveyName,"Survey name is required.");isValid=false}if(!questionContent.value.trim()){addErrorState(questionContent,"Question content is required.");isValid=false}if(!validateAnswers()){isValid=false}if(isValid){form.submit()}}function handleInputChange(event){const element=event.target.classList.contains("error")?event.target:event.target.closest(".error");if(element){removeErrorState(element)}}questionType.addEventListener("change",toggleAnswerOptions);addAnswerBtn.addEventListener("click",addAnswerChoice);answerChoices.addEventListener("click",removeAnswerChoice);form.addEventListener("submit",validateForm);form.addEventListener("input",handleInputChange);toggleAnswerOptions()}));